# 浅谈数据库索引
## 前言
组织需要我，我又变成了全干工程师。连表都要自己建，所以要复习复习数据库相关内容。

## 索引概述
在大学时刚接触索引这个词时，一直认为索引是表里的一个属性或者什么东西，“建索引”这个动作也是在表上的操作。但是后来明白了，索引是相对独立的，对于表，它像是一个附属的东西，有自己的存储空间。大概如下图：

![在这里输入图片描述][1]

看起来跟缓存有点像。

## 索引为什么快
首先，索引常用的数据结构有两种，B-Tree 和 Hash，这两种数据结构的查询数据(树, logN)都比较稳定而且不慢，在数据量大的时候对于查询速度的提升非常显著。其次，索引的数据结构决定了它不会有全表扫描的操作，所以速度上肯定比没索引查询快。

不过需要注意的是，sql 如果写得不好，就不会命中索引，那就直接到表里查，容易发生全表扫描。如何知道命中没？看看 [explain][2] 的用法。

## 关于索引的困惑
索引这么好，那么是不是我给表里每个字段都建立索引，那查询速度就得到提升呢？并不是。**因为每条 sql 查询只能使用一个索引**。如果 sql 语句时个组合查询，那么只会使用到其中一个字段的索引。[详细看这里][3]。所以，我们只能采取对于常用字段进行组合索引的方法来给表建立索引，以优化查询速度。

那这又衍生出另外一个疑惑，如果想要对现有业务进行大面积全方位的查询优化，那我是不是要根据每个业务点的每个查询的查询字段建立索引？并不是。在学习使用 explain 的时候，我发现了，**组合查询会命中包含组合字段子集的索引**。比如，有一张表叫 user，里面有四个字段 id, name, slogan, detail。我在 name 和 slogan 上建立的索引name_slogan，但是 select * from user where id = ? and name = ? and detail = ? 这条 sql 会命中 name_slogan。

所以，想要通用一点的优化的话，**可以针对大部分业务的通用查询字段建立一个组合索引**。


## 索引的使用要点

 1. [最左前缀匹配原则][4]
 2. 大部分业务的通用查询字段建立一个组合索引
 3. 不能无节制地建立索引
 4. [索引不生效的查询][5]

最后安利一个 mac 下的 mysql 工具 [sequelpro][6]，很好用。


  [1]: https://dn-coding-net-production-pp.qbox.me/61be3c80-928b-42f6-9774-8a8474c3225e.png
  [2]: http://blog.csdn.net/zhuxineli/article/details/14455029
  [3]: https://segmentfault.com/q/1010000003880137/a-1020000008232810
  [4]: https://www.zhihu.com/question/36996520/answer/93256153
  [5]: http://www.cnblogs.com/hongfei/archive/2012/10/20/2732589.html
  [6]: https://github.com/sequelpro/sequelpro